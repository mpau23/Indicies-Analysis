IndiciesAnalysis.controller("HeaderCtrl",["$scope","$rootScope",function(t,e){}]),IndiciesAnalysis.controller("HomeCtrl",["$scope","$http","$q","MarketDataService",function(t,e,a,r){function n(e,a,n,i,o){t.loading=!0,e||(e="SPY"),a||(a=15),n||(n=0),i||(i="monthly"),o||(o=2e3);var s=r.getOptions(e,a,n,i,o);s.then(function(e){e&&(t.marketData=e),t.loading=!1})}t.marketKeys=["SPY","FTSE","DAX","SLV","QQQ","IWM","GDX"],t.marketKey={value:t.marketKeys[0]},t.optionTypes=["weekly","monthly"],t.optionType={value:t.optionTypes[1]},t.loading=!1,n("SPY",15,0,"monthly",2e3),t.changeDaysToExpiry=function(){n(t.marketKey.value,t.openBeforeExpiry,t.closeBeforeExpiry,t.optionType.value,t.startYear)}}]),IndiciesAnalysis.controller("LoginCtrl",["$scope","$location","AuthenticationService",function(t,e,a){t.formError=!1,t.username="",t.password="",a.clearCredentials(),t.tryLogin=function(){a.login(t.username,t.password,function(r){t.shakeError=!1,r.success?(a.setCredentials(t.username,t.password),e.path("/")):(t.error=r.error,t.formError=!0)})}}]),IndiciesAnalysis.controller("RootCtrl",["$scope",function(t){t.root="root"}]),IndiciesAnalysis.factory("AuthenticationService",["Base64Service","$http","$cookies","$rootScope",function(t,e,a,r){var n={login:function(a,r,n){console.log("Attempting to log in"),e.get("/api/get/user/by-login/"+t.encode(a+":"+r)).then(function(t){n(t.data)})},setCredentials:function(n,i){console.log("Setting credentials");var o=t.encode(n+":"+i);console.log("Basic "+o),r.currentUser=o,e.defaults.headers.common.Authorization="Basic "+o;var s=new Date;s.addHours(1),a.put("currentUser",r.currentUser,{expires:s})},clearCredentials:function(){delete r.currentUser,a.remove("currentUser"),e.defaults.headers.common.Authorization="Basic auth"}};return n}]),IndiciesAnalysis.factory("Base64Service",function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(e){var a,r,n,i,o,s="",c="",l="",u=0;do a=e.charCodeAt(u++),r=e.charCodeAt(u++),c=e.charCodeAt(u++),n=a>>2,i=(3&a)<<4|r>>4,o=(15&r)<<2|c>>6,l=63&c,isNaN(r)?o=l=64:isNaN(c)&&(l=64),s=s+t.charAt(n)+t.charAt(i)+t.charAt(o)+t.charAt(l),a=r=c="",n=i=o=l="";while(u<e.length);return s},decode:function(e){var a,r,n,i,o,s="",c="",l="",u=0,d=/[^A-Za-z0-9\+\/\=]/g;d.exec(e)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do n=t.indexOf(e.charAt(u++)),i=t.indexOf(e.charAt(u++)),o=t.indexOf(e.charAt(u++)),l=t.indexOf(e.charAt(u++)),a=n<<2|i>>4,r=(15&i)<<4|o>>2,c=(3&o)<<6|l,s+=String.fromCharCode(a),64!=o&&(s+=String.fromCharCode(r)),64!=l&&(s+=String.fromCharCode(c)),a=r=c="",n=i=o=l="";while(u<e.length);return s}}}),IndiciesAnalysis.factory("MarketDataService",["$http","$q",function(t,e){var a={getOptions:function(a,r,n,i,o){var s=a+"/"+r+"/"+n+"/"+i+"/"+o;return marketDataPromise=t.get("/api/get/market-data/local/daily/"+s).then(function(t){return t?t.data:e.reject})}};return a}]),IndiciesAnalysis.directive("indiciesChartDirective",["$parse","$window",function(t,e){return{restrict:"EA",template:"<svg class='chart'></svg>",link:function(a,r,n){function i(){l=x.scale.ordinal().domain(y.map(function(t){return t.expiry.date})).rangeBands([0,w],.3,1),h=x.svg.axis().scale(l).orient("bottom"),u=x.scale.linear().domain(x.extent(y,function(t){return t.variance+t.highLowVariance})).range([C,0]),p=x.svg.axis().scale(u).orient("left").ticks(20,"%").tickSize(-w,0,0),d=x.scale.linear().domain(x.extent(y,function(t){return t.open.volatility?t.open.volatility/100:0})).range([u(0),0]),v=x.svg.axis().scale(d).orient("right").ticks(8,"%").tickSize(-w,0,0),g=x.svg.line().x(function(t){return l(t.expiry.date)}).y(function(t){return d(t.open.volatility?t.open.volatility/100:0)}).interpolate("linear"),f=x.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return" <div><span class='title'>Variance: </span><span class='value'>"+(100*t.variance).toFixed(2)+"%</span></div><div><span class='title'>High / Low Variance: </span><span class='value'> "+(100*t.highLowVariance).toFixed(2)+"%</span></div><div><span class='title'>Open Volatility: </span><span class='value'> "+t.open.volatility.toFixed(2)+"%</span></div><div><span class='title'>Open Date: </span><span class='value'> "+t.open.date+" </span></div><div><span class='title'>Open Price: </span><span class='value'> "+t.open.open.toFixed(2)+" </span></div><div><span class='title'>Exit Date: </span><span class='value'>"+t.expiry.date+" </span></div><div><span class='title'>Exit Price: </span><span class='value'> "+t.expiry.close.toFixed(2)+" </span></div>"}),$.call(f)}function o(t){i(),t?($.selectAll("g.y").call(p),$.selectAll("g.y2").attr("transform","translate("+w+" ,0)").call(v),$.selectAll("g.x").attr("transform","translate(0,"+u(0)+")").call(h),$.selectAll(".bar").remove(),$.selectAll(".line").remove()):($.append("g").attr("class","x axis").attr("transform","translate(0,"+u(0)+")").call(h).selectAll("text"),$.append("g").attr("class","y axis").call(p),$.append("g").attr("class","y2 axis").attr("transform","translate("+w+" ,0)").call(v)),$.selectAll(".graph-container.bar").data(y).enter().append("rect").attr("class","bar highlow").attr("data-value",function(t){return t.highLowVariance}).attr("data-date",function(t){return t.expiry.date}).attr("x",function(t){return l(t.expiry.date)}).attr("width",l.rangeBand()).attr("y",function(t){return t.highLowVariance?u(Math.max(0,t.highLowVariance+t.variance)):0}).attr("height",function(t){return t.highLowVariance?Math.abs(u(t.highLowVariance+t.variance)-u(0)):0}).on("mouseover",f.show).on("mouseout",f.hide),$.selectAll(".graph-container.bar").data(y).enter().append("rect").attr("class","bar variance").attr("data-value",function(t){return t.variance}).attr("x",function(t){return l(t.expiry.date)}).attr("width",l.rangeBand()).attr("y",function(t){return t.variance?u(Math.max(0,t.variance)):0}).attr("height",function(t){return t.variance?Math.abs(u(t.variance)-u(0)):0}).on("mouseover",f.show).on("mouseout",f.hide),$.append("path").attr("class","line").attr("d",g(y))}function s(){w=parseInt(x.select(".chart").style("width"),10)-A.left-A.right,o(!0)}function c(){x.selectAll("g.y .tick").on("mouseover",function(t){var e=x.transform(x.select(this).attr("transform")).translate[1],a=new Array;x.selectAll(".bar").each(function(){var t=e<u(0),r=x.select(this).attr("x"),n=x.select(this).attr("height");if(t){var i=x.select(this).attr("y");e>i&&u(0)>i&&0!=n&&a.push(r)}else{var i=parseInt(x.select(this).attr("y"))+parseInt(x.select(this).attr("height"));i>e&&u(0)<i&&0!=n&&a.push(r)}}),x.selectAll(".bar").filter(function(){return a.indexOf(x.select(this).attr("x"))<0}).each(function(){x.select(this).style("opacity",.2)})}).on("mouseout",function(t){x.selectAll(".bar").each(function(){x.select(this).style("opacity",1)})})}var l,u,d,h,p,v,f,g,m=t(n.chartData),y=m(a),x=e.d3,A={top:20,right:40,bottom:30,left:25},w=parseInt(x.select(".chart").style("width"),10)-A.left-A.right,C=600-A.top-A.bottom,$=x.select(".chart").attr("width",w+A.left+A.right).attr("height",C+A.top+A.bottom).append("g").attr("transform","translate("+A.left+","+A.top+")").attr("class","graph-container");a.$watchCollection(m,function(t,e){y=t;var a=!1;y&&(e?(a=!0,o(a)):(o(a),c()))}),x.select(window).on("resize",s)}}}]),IndiciesAnalysis.run(["$rootScope","$location","$cookies","$http",function(t,e,a,r){t.currentUser=a.get("currentUser"),t.currentUser&&(r.defaults.headers.common.Authorization="Basic "+t.currentUser),t.$on("$locationChangeStart",function(r,n,i){t.currentUser;"/login"==e.path()||a.get("currentUser")||e.path("/login")})}]),IndiciesAnalysis.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(t,e,a){a.html5Mode(!0),e.otherwise("/"),t.state("index",{url:"/",views:{"@":{templateUrl:"views/root.html"},"header@index":{templateUrl:"views/root.header.html",controller:"HeaderCtrl"},"@index":{templateUrl:"views/root.home.html",controller:"HomeCtrl"}}}).state("index.login",{url:"login",views:{"@index":{templateUrl:"views/root.login.html",controller:"LoginCtrl",url:"login"}}})}]);var jq=jQuery.noConflict();jq(document).on("mouseenter",".tick text",function(){jq(this).prev("line").css("opacity","1")}),jq(document).on("mouseleave",".tick text",function(){jq(this).prev("line").css("opacity","0")});