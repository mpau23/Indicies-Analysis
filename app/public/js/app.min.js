function type(e){return e.variance=+e.variance,e}IndiciesAnalysis.controller("RootCtrl",["$scope","$http","$q","MarketDataService","CalendarDataService",function(e,a,t,r,n){function i(){var a=r.getDailyMarketData(2e3),i=n.getMonthlyOptions(12,2e3);t.all([a]).then(function(a){var t=a[0];angular.forEach(i,function(e,a){var r=Date.parse(e.expiry.date),n=Date.parse(e.open.date),i=t[r.getTime()],o=t[n.getTime()];if(i?(e.expiry.open=i.open,e.expiry.close=i.close,e.expiry.high=i.high,e.expiry.low=i.low):console.log(r+": not in market data"),o?(e.open.open=o.open,e.open.close=o.close,e.open.high=o.high,e.open.low=o.low):console.log(n+": not in market data"),i&&o){e.variance=(i.close-o.open)/o.open;for(var c=e.open.high,s=e.open.low;r>n;)n.addWeekdays(1),t[n.getTime()]&&(t[n.getTime()].high>c&&(c=t[n.getTime()].high),t[n.getTime()].low<s&&(s=t[n.getTime()].low)),e.highestHigh=c,e.lowestLow=s;e.variance>0?e.highLowVariance=(c-e.open.open)/e.open.open-e.variance:e.highLowVariance=(s-e.open.open)/e.open.open-e.variance}}),console.log(i),e.marketData=i})}i()}]),IndiciesAnalysis.factory("CalendarDataService",["$http","$q",function(e,a){var t={getMonthlyExpiries:function(e){var a=new Array,t=Date.parse("today"),r=Date.parse("1-1-"+e),n=r.moveToNthOccurrence(5,3);for(a.push({expiry:{date:n.toString("d-MMM-yyyy")}});t>n;)r.addMonths(1),n=r.moveToNthOccurrence(5,3),a.push({expiry:{date:n.toString("d-MMM-yyyy")}});return a},getMonthlyOptions:function(e,a){var r=t.getMonthlyExpiries(a);return angular.forEach(r,function(a,t){var r=Date.parse(a.expiry.date);r.addWeekdays(-e),a.open={date:r.toString("d-MMM-yyyy")}}),r}};return t}]),IndiciesAnalysis.factory("MarketDataService",["$http","$q",function(e,a){var t={getDailyMarketData:function(t){return marketDataPromise=e.get("/api/get/market-data/daily/"+t).then(function(e){if(e){var t=[];return angular.forEach(e.data.dataset.data,function(e,a){var r=Date.parse(e[0]);t[r.getTime()]={date:e[0],open:e[1],high:e[2],low:e[3],close:e[4]}}),t}return a.reject})}};return t}]),IndiciesAnalysis.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,a,t){t.html5Mode(!0),a.otherwise("/"),e.state("home",{name:"home",url:"/",templateUrl:"views/home.html",controller:"RootCtrl"})}]);var data=[{date:"01-01-16",variance:.012,highLowVariance:.03},{date:"02-01-16",variance:-.01,highLowVariance:.056},{date:"03-01-16",variance:.0193,highLowVariance:.014}],margin={top:20,right:20,bottom:30,left:40},width=500-margin.left-margin.right,height=400-margin.top-margin.bottom,x=d3.scale.ordinal().rangeRoundBands([0,width],.1),y=d3.scale.linear().range([height,0]),xAxis=d3.svg.axis().scale(x).orient("bottom"),yAxis=d3.svg.axis().scale(y).orient("left").ticks(10,"%"),svg=d3.select(".chart").attr("width",width+margin.left+margin.right).attr("height",height+margin.top+margin.bottom).append("g").attr("transform","translate("+margin.left+","+margin.top+")");console.log(data),y.domain(d3.extent(data,function(e){return e.variance})).nice(),x.domain(data.map(function(e){return e.date})),svg.append("g").attr("class","x axis").attr("transform","translate(0,"+y(0)+")").call(xAxis),svg.append("g").attr("class","y axis").call(yAxis),svg.selectAll(".bar").data(data).enter().append("rect").attr("class","bar").attr("x",function(e){return x(e.date)}).attr("width",x.rangeBand()).attr("y",function(e){return y(Math.max(0,e.variance))}).attr("height",function(e){return Math.abs(y(e.variance)-y(0))});