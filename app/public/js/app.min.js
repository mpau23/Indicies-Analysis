IndiciesAnalysis.controller("RootCtrl",["$scope","$http","$q","MarketDataService","CalendarDataService",function(e,t,a,o,n){function r(){var t=o.getDailyMarketData(2e3),r=n.getMonthlyOptions(12,2e3);a.all([t]).then(function(t){var a=t[0];angular.forEach(r,function(e,t){var o=Date.parse(e.expiry.date),n=Date.parse(e.open.date),r=a[o.getTime()],i=a[n.getTime()];if(r?(e.expiry.open=r.open,e.expiry.close=r.close,e.expiry.high=r.high,e.expiry.low=r.low):console.log(o+": not in market data"),i?(e.open.open=i.open,e.open.close=i.close,e.open.high=i.high,e.open.low=i.low):console.log(n+": not in market data"),r&&i){e.variance=(r.close-i.open)/i.open;for(var c=e.open.high,l=e.open.low;o>n;)n.addWeekdays(1),a[n.getTime()]&&(a[n.getTime()].high>c&&(c=a[n.getTime()].high),a[n.getTime()].low<l&&(l=a[n.getTime()].low)),e.highestHigh=c,e.lowestLow=l;e.variance>0?e.highLowVariance=(c-e.open.open)/e.open.open-e.variance:e.highLowVariance=(l-e.open.open)/e.open.open-e.variance}}),console.log(r),e.marketData=r})}r()}]),IndiciesAnalysis.factory("CalendarDataService",["$http","$q",function(e,t){var a={getMonthlyExpiries:function(e){var t=new Array,a=Date.parse("today"),o=Date.parse("1-1-"+e),n=o.moveToNthOccurrence(5,3);for(t.push({expiry:{date:n.toString("d-MMM-yyyy")}});a>n;)o.addMonths(1),n=o.moveToNthOccurrence(5,3),t.push({expiry:{date:n.toString("d-MMM-yyyy")}});return t},getMonthlyOptions:function(e,t){var o=a.getMonthlyExpiries(t);return angular.forEach(o,function(t,a){var o=Date.parse(t.expiry.date);o.addWeekdays(-e),t.open={date:o.toString("d-MMM-yyyy")}}),o}};return a}]),IndiciesAnalysis.factory("MarketDataService",["$http","$q",function(e,t){var a={getDailyMarketData:function(a){return marketDataPromise=e.get("/api/get/market-data/daily/"+a).then(function(e){if(e){var a=[];return angular.forEach(e.data.dataset.data,function(e,t){var o=Date.parse(e[0]);a[o.getTime()]={date:e[0],open:e[1],high:e[2],low:e[3],close:e[4]}}),a}return t.reject})}};return a}]),IndiciesAnalysis.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,a){a.html5Mode(!0),t.otherwise("/"),e.state("home",{name:"home",url:"/",templateUrl:"views/home.html",controller:"RootCtrl"})}]);