IndiciesAnalysis.controller("LoginCtrl",["$scope","$location","AuthenticationService",function(t,e,a){t.formError=!1,t.username="",t.password="",a.clearCredentials(),t.tryLogin=function(){a.login(t.username,t.password,function(n){t.shakeError=!1,n.success?(a.setCredentials(t.username,t.password),e.path("/")):(t.error=n.error,t.formError=!0)})}}]),IndiciesAnalysis.controller("RootCtrl",["$scope","$http","$q","MarketDataService",function(t,e,a,n){function r(e,a,r,i,o){t.loading=!0,e||(e="SPY"),a||(a=15),r||(r=0),i||(i="monthly"),o||(o=2e3);var s=n.getOptions(e,a,r,i,o);s.then(function(e){e&&(t.marketData=e),t.loading=!1})}t.marketKeys=["SPY","FTSE","DAX","SLV","QQQ","IWM","GDX"],t.marketKey={value:t.marketKeys[0]},t.optionTypes=["weekly","monthly"],t.optionType={value:t.optionTypes[1]},t.loading=!1,r("SPY",15,0,"monthly",2e3),t.changeDaysToExpiry=function(){r(t.marketKey.value,t.openBeforeExpiry,t.closeBeforeExpiry,t.optionType.value,t.startYear)}}]),IndiciesAnalysis.factory("AuthenticationService",["Base64Service","$http","$cookies","$rootScope",function(t,e,a,n){var r={login:function(a,n,r){console.log("Attempting to log in"),e.get("/api/get/user/by-login/"+t.encode(a+":"+n)).then(function(t){r(t.data)})},setCredentials:function(r,i){console.log("Setting credentials");var o=t.encode(r+":"+i);console.log("Basic "+o),n.currentUser=o,e.defaults.headers.common.Authorization="Basic "+o;var s=new Date;s.addHours(1),a.put("currentUser",n.currentUser,{expires:s})},clearCredentials:function(){delete n.currentUser,a.remove("currentUser"),e.defaults.headers.common.Authorization="Basic auth"}};return r}]),IndiciesAnalysis.factory("Base64Service",function(){var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(e){var a,n,r,i,o,s="",c="",l="",u=0;do a=e.charCodeAt(u++),n=e.charCodeAt(u++),c=e.charCodeAt(u++),r=a>>2,i=(3&a)<<4|n>>4,o=(15&n)<<2|c>>6,l=63&c,isNaN(n)?o=l=64:isNaN(c)&&(l=64),s=s+t.charAt(r)+t.charAt(i)+t.charAt(o)+t.charAt(l),a=n=c="",r=i=o=l="";while(u<e.length);return s},decode:function(e){var a,n,r,i,o,s="",c="",l="",u=0,d=/[^A-Za-z0-9\+\/\=]/g;d.exec(e)&&window.alert("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");do r=t.indexOf(e.charAt(u++)),i=t.indexOf(e.charAt(u++)),o=t.indexOf(e.charAt(u++)),l=t.indexOf(e.charAt(u++)),a=r<<2|i>>4,n=(15&i)<<4|o>>2,c=(3&o)<<6|l,s+=String.fromCharCode(a),64!=o&&(s+=String.fromCharCode(n)),64!=l&&(s+=String.fromCharCode(c)),a=n=c="",r=i=o=l="";while(u<e.length);return s}}}),IndiciesAnalysis.factory("MarketDataService",["$http","$q",function(t,e){var a={getOptions:function(a,n,r,i,o){var s=a+"/"+n+"/"+r+"/"+i+"/"+o;return marketDataPromise=t.get("/api/get/market-data/local/daily/"+s).then(function(t){return t?t.data:e.reject})}};return a}]),IndiciesAnalysis.directive("indiciesChartDirective",["$parse","$window",function(t,e){return{restrict:"EA",template:"<svg class='chart'></svg>",link:function(a,n,r){function i(){c=f.scale.ordinal().domain(g.map(function(t){return t.expiry.date})).rangeBands([0,y],.3,1),u=f.svg.axis().scale(c).orient("bottom"),l=f.scale.linear().domain(f.extent(g,function(t){return t.variance+t.highLowVariance})).range([x,0]),d=f.svg.axis().scale(l).orient("left").ticks(20,"%").tickSize(-y,0,0),y2=f.scale.linear().domain(f.extent(g,function(t){return t.open.volatility?t.open.volatility/100:0})).range([l(0),0]),y2Axis=f.svg.axis().scale(y2).orient("right").ticks(8,"%").tickSize(-y,0,0),h=f.svg.line().x(function(t){return c(t.expiry.date)}).y(function(t){return t.open.volatility?y2(t.open.volatility/100):y2(0)}).interpolate("linear"),p=f.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){return" <div><span class='title'>Variance: </span><span class='value'>"+(100*t.variance).toFixed(2)+"%</span></div><div><span class='title'>High / Low Variance: </span><span class='value'> "+(100*t.highLowVariance).toFixed(2)+"%</span></div><div><span class='title'>Open Volatility: </span><span class='value'> "+t.open.volatility.toFixed(2)+"%</span></div><div><span class='title'>Open Date: </span><span class='value'> "+t.open.date+" </span></div><div><span class='title'>Open Price: </span><span class='value'> "+t.open.open.toFixed(2)+" </span></div><div><span class='title'>Exit Date: </span><span class='value'>"+t.expiry.date+" </span></div><div><span class='title'>Exit Price: </span><span class='value'> "+t.expiry.close.toFixed(2)+" </span></div>"}),A.call(p)}function o(t){i(),t?(A.selectAll("g.y").call(d),A.selectAll("g.y2").attr("transform","translate("+y+" ,0)").call(y2Axis),A.selectAll("g.x").attr("transform","translate(0,"+l(0)+")").call(u),A.selectAll(".bar").remove(),A.selectAll(".line").remove()):(A.append("g").attr("class","x axis").attr("transform","translate(0,"+l(0)+")").call(u).selectAll("text"),A.append("g").attr("class","y axis").call(d),A.append("g").attr("class","y2 axis").attr("transform","translate("+y+" ,0)").call(y2Axis)),A.selectAll(".graph-container.bar").data(g).enter().append("rect").attr("class","bar highlow").attr("data-value",function(t){return t.highLowVariance}).attr("x",function(t){return c(t.expiry.date)}).attr("width",c.rangeBand()).attr("y",function(t){return t.highLowVariance?l(Math.max(0,t.highLowVariance+t.variance)):0}).attr("height",function(t){return t.highLowVariance?Math.abs(l(t.highLowVariance+t.variance)-l(0)):0}).on("mouseover",p.show).on("mouseout",p.hide),A.selectAll(".graph-container.bar").data(g).enter().append("rect").attr("class","bar variance").attr("data-value",function(t){return t.variance}).attr("x",function(t){return c(t.expiry.date)}).attr("width",c.rangeBand()).attr("y",function(t){return t.variance?l(Math.max(0,t.variance)):0}).attr("height",function(t){return t.variance?Math.abs(l(t.variance)-l(0)):0}).on("mouseover",p.show).on("mouseout",p.hide),A.append("path").attr("class","line").attr("d",h(g))}function s(){y=parseInt(f.select(".chart").style("width"),10)-m.left-m.right,o(!0)}var c,l,u,d,p,h,v=t(r.chartData),g=v(a),f=e.d3,m={top:20,right:40,bottom:30,left:25},y=parseInt(f.select(".chart").style("width"),10)-m.left-m.right,x=600-m.top-m.bottom,A=f.select(".chart").attr("width",y+m.left+m.right).attr("height",x+m.top+m.bottom).append("g").attr("transform","translate("+m.left+","+m.top+")").attr("class","graph-container");a.$watchCollection(v,function(t,e){g=t;var a=!1;g&&(e&&(a=!0),o(a))}),f.select(window).on("resize",s)}}}]),IndiciesAnalysis.run(["$rootScope","$location","$cookies","$http",function(t,e,a,n){t.currentUser=a.get("currentUser"),t.currentUser&&(n.defaults.headers.common.Authorization="Basic "+t.currentUser),t.$on("$locationChangeStart",function(n,r,i){t.currentUser;"/login"==e.path()||a.get("currentUser")||e.path("/login")})}]),IndiciesAnalysis.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(t,e,a){a.html5Mode(!0),e.otherwise("/"),t.state("home",{name:"home",url:"/",templateUrl:"views/home.html",controller:"RootCtrl"}).state("login",{name:"login",url:"/login",templateUrl:"views/login.html",controller:"LoginCtrl"})}]);var jq=jQuery.noConflict();jq(document).on("mouseenter",".tick text",function(){jq(this).prev("line").css("opacity","1")}),jq(document).on("mouseleave",".tick text",function(){jq(this).prev("line").css("opacity","0")});